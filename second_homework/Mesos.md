# Mesos Note

## Mesos是啥

Mesos是一个可以在不同集群架构上共享商品计算机集群的平台。

## 它解决了什么问题

当前共享集群的通用办法是静态地划分集群，在每个分区中运行一个集群架构；或者给每种价格分配若干组虚拟机。它们存在一个通病，既不能真正实现高利用率也没能有效地进行数据共享。集群框架的独立开发导致无法跨集群框架地共享粒度，使得在不同集群框架中有效地共享计算集群和数据十分困难。Mesos通过对集群框架提供共有的访问集群资源的接口使得在不同集群计算框架间精细地分享粒度成为了可能。

## 它用了哪些重要方法

* 在资源分配上，Mesos将资源分配的工作交给了一个可插拔的分配模块，组织机构可以更改分配模块来适应不同的需求。它利用大多数任务的生命周期都不长的事实，仅在任务结束时重新分配资源。
* 在隔离方面，Mesos利用现有操作系统的隔离机制，为运行在同一个Slave节点上的集群框架Executor提供了性能上的隔离。（目前是容器技术）
* 在Resource Offers的可扩展和Robust方面，Mesos提供了三种机制实现该目标：它允许集群框架缩短拒绝的进程，通过提供Filters来组织交流；它以集群框架在计算集群中的份额为参考计算将要提供的资源；它会在Resource Offer长时间未被响应后撤回该Resource Offer并且将它提供给其它集群框架。
* 在容错方面，Mesos的Master被设计为软状态，因此新的Master进程可以利用节点和调度器上的信息完整的重建自己的内部状态。

## 效果如何

对比4个集群框架的工作负载（Hadoop，混合运行着基于Facebook工作负载的小作业和大作业；Hadoop，运行着一系列大作业；Spark，运行着一系列机器学习作业；Torque，运行着一系列MPI作业）在公平共享的应用场景和静态分配的应用场景下的性能表现，Mesos比静态分区取得了更高的使用率，完成速度也比静态分区共享集群更快一些，并且可能由于其它集群框架的需求差异而变得更快一些。而在单一集群框架使用集群时，Mesos带来的额外开销在论文中的两次测试中均小于4%。由于使用数据本地化，作业的运作效率得到了提高，在5s的延迟调度场景中Mesos比静态分区场景的运行速度提升了1.7倍。而在错误恢复方面，在杀死主节点之后，所有Slave节点和集群框架连接到第二个主节点的时间在4-8秒之间，其中3s的置信区间达到了95%。

## 我的思考

Mesos是一个轻薄的，允许多样化集群框架有效共享资源的管理层，它在Task级别的细粒度的共享模型和被称作Resource Offers的分布式调度机制使得它能够获得高的使用率同时对工作负载的改变响应迅速，并且满足了多个集群框架保持可扩展性和Robust的需求，牛逼！